---
# roles/nvim_packer/tasks/main.yml

- name: Set XGD_DATA_HOME from environment or fall back on default.
  ansible.builtin.set_fact:
    XGD_DATA_HOME: >-
      {{
        ansible_env.XDG_DATA_HOME
        | default(ansible_env.HOME + "/.local/share")
      }}

- name: Ensure XGD_DATA_HOME directory is created.
  ansible.builtin.file:
    path: "{{ XGD_DATA_HOME }}"
    state: directory
    mode: "{{ platform[ansible_os_family].user_dir_mode }}"

- name: Install nvim packer from Git repo.
  ansible.builtin.git:
    repo: "{{ nvim_packer_repo_url }}"
    dest: "{{ XGD_DATA_HOME }}/nvim/site/pack/packer/start/packer.nvim"
    update: "{{ nvim_packer_update | bool }}"
    depth: 1
    version: "{{ nvim_packer_version }}"
